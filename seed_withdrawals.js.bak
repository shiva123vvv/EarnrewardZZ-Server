const db = require('./utils/db');
const User = require('./models/User');
const Withdrawal = require('./models/Withdrawal');

const seedWithdrawals = async () => {
    try {
        await db.checkConnection();
        console.log("ðŸ”„ Syncing schema...");
        await db.sequelize.sync(); // Ensure tables exist

        // 1. Get or Create a dummy user for these withdrawals
        let user = await User.findOne({ where: { email: 'demo_user@example.com' } });
        if (!user) {
            user = await User.create({
                email: 'demo_user@example.com',
                firebase_uid: 'demo_uid_12345',
                role: 'user',
                wallet_balance: 50.00
            });
            console.log("Created demo user.");
        }

        console.log("ðŸŒ± Seeding Mock Withdrawals...");

        const mockData = [
            // PENDING
            {
                user_id: user.id,
                amount: 15.00,
                payment_method: 'UPI',
                upi_id: 'demo@oksbi',
                status: 'PENDING',
                created_at: new Date()
            },
            {
                user_id: user.id,
                amount: 25.50,
                payment_method: 'PAYPAL',
                paypal_email: 'demo_user@example.com',
                status: 'PENDING',
                created_at: new Date(Date.now() - 3600000) // 1 hour ago
            },
            // APPROVED
            {
                user_id: user.id,
                amount: 100.00,
                payment_method: 'UPI',
                upi_id: 'demo@ybl',
                status: 'APPROVED',
                created_at: new Date(Date.now() - 86400000), // 1 day ago
                processed_at: new Date(Date.now() - 82800000),
                admin_note: 'Processed via Bank Transfer'
            },
            {
                user_id: user.id,
                amount: 50.00,
                payment_method: 'PAYPAL',
                paypal_email: 'demo@paypal.com',
                status: 'APPROVED',
                created_at: new Date(Date.now() - 172800000), // 2 days ago
                processed_at: new Date(Date.now() - 169200000)
            },
            // REJECTED
            {
                user_id: user.id,
                amount: 500.00,
                payment_method: 'UPI',
                upi_id: 'fake@upi',
                status: 'REJECTED',
                created_at: new Date(Date.now() - 259200000), // 3 days ago
                processed_at: new Date(Date.now() - 255600000),
                admin_note: 'Invalid UPI ID / Suspicious Activity'
            }
        ];

        // Bulk Create (using individual create to ensure hooks/validation if any, safe for seeding)
        for (const w of mockData) {
            await Withdrawal.create(w);
        }

        console.log("âœ… Mock Withdrawals Seeded Successfully!");

    } catch (err) {
        console.error("Seed Error:", err);
    }
    process.exit();
};

seedWithdrawals();
